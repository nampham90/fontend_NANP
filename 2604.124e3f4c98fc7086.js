"use strict";(self.webpackChunkng_ant_admin=self.webpackChunkng_ant_admin||[]).push([[2604],{2604:(H,k,o)=>{o.r(k),o.d(k,{WebsocketComponent:()=>Q});var Z=o(4755),t=o(2223),D=o(5855),f=o(9401),O=o(9019),J=o(4895),S=o(4259),T=o(3642),x=o(4247),g=o(1929),b=o(8397),F=o(7908),A=o(7267),m=o(7579),j=o(930),C=o(9751),w=o(727),y=o(4707);const E={url:"",deserializer:c=>JSON.parse(c.data),serializer:c=>JSON.stringify(c)};class z extends m.u{constructor(e,n){if(super(),this._socket=null,e instanceof C.y)this.destination=n,this.source=e;else{const s=this._config=Object.assign({},E);if(this._output=new m.x,"string"==typeof e)s.url=e;else for(const a in e)e.hasOwnProperty(a)&&(s[a]=e[a]);if(!s.WebSocketCtor&&WebSocket)s.WebSocketCtor=WebSocket;else if(!s.WebSocketCtor)throw new Error("no WebSocket constructor can be found");this.destination=new y.t}}lift(e){const n=new z(this._config,this.destination);return n.operator=e,n.source=this,n}_resetState(){this._socket=null,this.source||(this.destination=new y.t),this._output=new m.x}multiplex(e,n,s){const a=this;return new C.y(i=>{try{a.next(e())}catch(h){i.error(h)}const r=a.subscribe({next:h=>{try{s(h)&&i.next(h)}catch(u){i.error(u)}},error:h=>i.error(h),complete:()=>i.complete()});return()=>{try{a.next(n())}catch(h){i.error(h)}r.unsubscribe()}})}_connectSocket(){const{WebSocketCtor:e,protocol:n,url:s,binaryType:a}=this._config,i=this._output;let r=null;try{r=n?new e(s,n):new e(s),this._socket=r,a&&(this._socket.binaryType=a)}catch(u){return void i.error(u)}const h=new w.w0(()=>{this._socket=null,r&&1===r.readyState&&r.close()});r.onopen=u=>{const{_socket:d}=this;if(!d)return r.close(),void this._resetState();const{openObserver:W}=this._config;W&&W.next(u);const v=this.destination;this.destination=j.Lv.create(l=>{if(1===r.readyState)try{const{serializer:p}=this._config;r.send(p(l))}catch(p){this.destination.error(p)}},l=>{const{closingObserver:p}=this._config;p&&p.next(void 0),l&&l.code?r.close(l.code,l.reason):i.error(new TypeError("WebSocketSubject.error must be called with an object with an error code, and an optional reason: { code: number, reason: string }")),this._resetState()},()=>{const{closingObserver:l}=this._config;l&&l.next(void 0),r.close(),this._resetState()}),v&&v instanceof y.t&&h.add(v.subscribe(this.destination))},r.onerror=u=>{this._resetState(),i.error(u)},r.onclose=u=>{r===this._socket&&this._resetState();const{closeObserver:d}=this._config;d&&d.next(u),u.wasClean?i.complete():i.error(u)},r.onmessage=u=>{try{const{deserializer:d}=this._config;i.next(d(u))}catch(d){i.error(d)}}}_subscribe(e){const{source:n}=this;return n?n.subscribe(e):(this._socket||this._connectSocket(),this._output.subscribe(e),e.add(()=>{const{_socket:s}=this;0===this._output.observers.length&&(s&&(1===s.readyState||0===s.readyState)&&s.close(),this._resetState())}),e)}unsubscribe(){const{_socket:e}=this;e&&(1===e.readyState||0===e.readyState)&&e.close(),this._resetState(),super.unsubscribe()}}var U=o(2242);function M(c,e){if(1&c&&(t.ynx(0),t.TgZ(1,"div",10)(2,"span",11),t._uU(3),t.qZA()(),t.TgZ(4,"div",12),t._uU(5,"\u5df2\u8bfb"),t.qZA(),t.BQk()),2&c){const n=e.$implicit;t.xp6(3),t.Oqu(n)}}const N=function(){return[16,16]},R=function(){return{minRows:3,maxRows:5}};let Q=(()=>{class c{constructor(n){this.cdr=n,this.concate=!0,this.destroyRef=(0,t.f3M)(t.ktI),this.pageHeaderInfo={title:"websocket",breadcrumb:["\u9996\u9875","\u529f\u80fd","websocket"]},this.subject=function I(c){return new z(c)}(`ws://${O.ip}:8003/webSocket`),this.result=[],this.msg=""}send(){this.subject.next(this.msg),this.msg=""}end(){this.subject.complete(),this.concate=!1}ngOnInit(){}ngAfterViewInit(){this.subject.pipe((0,D.sL)(this.destroyRef)).subscribe(n=>{this.result.push(n.message),this.result=[...this.result],this.cdr.markForCheck()})}ngOnDestroy(){this.subject.complete()}}return c.\u0275fac=function(n){return new(n||c)(t.Y36(t.sBO))},c.\u0275cmp=t.Xpm({type:c,selectors:[["app-websocket"]],standalone:!0,features:[t.jDz],decls:14,vars:8,consts:[[3,"pageHeaderInfo"],[1,"normal-table-wrap"],["nz-row","",3,"nzGutter"],["nz-col","","nzFlex","300px"],["nz-input","","placeholder","\u53d1\u9001\u7684\u5185\u5bb9\u670d\u52a1\u7aef\u4f1a\u8fd4\u56de",1,"m-b-8",3,"nzAutosize","ngModel","ngModelChange"],["nz-button","","nzType","primary",3,"click"],["nz-button","","nzType","default",1,"m-l-8",3,"click"],["nz-col","","nzFlex","auto"],["nzTitle","\u6d88\u606f\u5185\u5bb9"],[4,"ngFor","ngForOf"],["nz-result-content","",1,"m-t-0","p-8","text-break","m-b-8"],["nz-typography",""],["nz-typography","","nzType","secondary",1,"sp-12","text-right","m-t-5"]],template:function(n,s){1&n&&(t._UZ(0,"app-page-header",0),t.TgZ(1,"div",1)(2,"div",2)(3,"div",3)(4,"textarea",4),t.NdJ("ngModelChange",function(i){return s.msg=i}),t.qZA(),t.TgZ(5,"button",5),t.NdJ("click",function(){return s.send()}),t._uU(6,"\u53d1\u9001"),t.qZA(),t.TgZ(7,"button",6),t.NdJ("click",function(){return s.end()}),t._uU(8,"\u65ad\u5f00\u8fde\u63a5"),t.qZA(),t.TgZ(9,"span"),t._uU(10),t.qZA()(),t.TgZ(11,"div",7)(12,"nz-card",8),t.YNc(13,M,6,1,"ng-container",9),t.qZA()()()()),2&n&&(t.Q6J("pageHeaderInfo",s.pageHeaderInfo),t.xp6(2),t.Q6J("nzGutter",t.DdM(6,N)),t.xp6(2),t.Q6J("nzAutosize",t.DdM(7,R))("ngModel",s.msg),t.xp6(6),t.hij("\u94fe\u63a5\u72b6\u6001\uff1a",s.concate,""),t.xp6(3),t.Q6J("ngForOf",s.result))},dependencies:[J.q,g.Jb,g.t3,g.SK,b.o7,b.Zp,b.rh,f.u5,f.Fj,f.JJ,f.On,S.sL,S.ix,U.w,x.dQ,x.vG,T.vh,T.bd,Z.ax,F.XD,F.HO,A.ZJ,A.ZU],encapsulation:2,changeDetection:0}),c})()}}]);